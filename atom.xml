<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-cn"><title type="text">哲學誌 — Wah Lau</title><subtitle type="html">哲學之网誌，爱美爱智慧。</subtitle><updated>2024-02-28T16:08:56+00:00</updated><id>https://www.ooim.xyz/</id><link rel="alternate" type="text/html" href="https://www.ooim.xyz/"/><link rel="self" type="application/atom+xml" href="https://www.ooim.xyz/atom.xml"/><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><generator uri="https://gohugo.io/" version="0.123.4">Hugo</generator><entry><title type="text">Hugo 内建 highlight 配置踩坑</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/hugo-highlight/"/><id>https://www.ooim.xyz/notes/hugo-highlight/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2024-01-08T22:21:25+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">溯源 Hugo uses Chroma as its code highlighter; it is built in Go and is really, really fast. 既然内建了，秉持极简主义的原则，毕竟够用就好。……</summary><content type="html">&lt;h2 id="溯源">溯源&lt;/h2>
&lt;blockquote>
&lt;p>Hugo uses &lt;a href="https://gohugo.io/content-management/syntax-highlighting/">Chroma&lt;/a> as its code highlighter; it is built in Go and is really, really fast.&lt;/p>
&lt;/blockquote>
&lt;p>既然内建了，秉持极简主义的原则，毕竟够用就好。那就Chroma吧&lt;/p>
&lt;h2 id="清理原来的">清理原来的&lt;/h2>
&lt;p>原来&lt;code>config.toml&lt;/code> 自带有这段代码，也起着高亮的作用。必须先删掉。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>paginate = 6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsCodeFences = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsCodefencesGuessSyntax = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsUseClasses = true
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="新配置">新配置&lt;/h2>
&lt;p>再加入&lt;/p>
&lt;div class="highlight">&lt;div style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10
&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11
&lt;/span>&lt;span style="background-color:#3d3d3d">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12
&lt;/span>&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">13
&lt;/span>&lt;span style="background-color:#3d3d3d">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">14
&lt;/span>&lt;/span>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>[markup]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [markup.highlight]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> anchorLineNos = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> codeFences = &lt;span style="color:#fe8019">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> guessSyntax = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hl_Lines = &lt;span style="color:#b8bb26">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hl_inline = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lineAnchors = &lt;span style="color:#b8bb26">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lineNoStart = &lt;span style="color:#d3869b">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lineNos = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lineNumbersInTable = &lt;span style="color:#fe8019">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3d3d3d">&lt;span> noClasses = &lt;span style="color:#fe8019">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> noHl = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3d3d3d">&lt;span> style = &lt;span style="color:#b8bb26">&amp;#39;monokai&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tabWidth = &lt;span style="color:#d3869b">4&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最终呈现&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>baseURL = &amp;#34;https://ooim.xyz&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>languageCode = &amp;#34;zh-cn&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>theme = &amp;#34;jingzhe&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>themesDir = &amp;#34;themes&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>title = &amp;#34;或跃在渊&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paginate = 6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enableRobotsTXT = true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paginate = 6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsCodeFences = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsCodefencesGuessSyntax = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">- pygmentsUseClasses = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#fb4934">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[markup]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ [markup.highlight]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ anchorLineNos = false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ codeFences = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ guessSyntax = false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ hl_Lines = &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ hl_inline = false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ lineAnchors = &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ lineNoStart = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ lineNos = false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ lineNumbersInTable = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ noClasses = true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ noHl = false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ style = &amp;#34;gruvbox&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#282828;background-color:#b8bb26">+ tabWidth = 4
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>更多的&lt;a href="https://xyproto.github.io/splash/docs/all.html">&lt;code>style&lt;/code>&lt;/a>&lt;/p>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://gohugo.io/functions/transform/highlight/">官方1&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gohugo.io/getting-started/configuration-markup/#highlight">官方2&lt;/a>&lt;/li>
&lt;/ul></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/hugo/" term="Hugo" label="Hugo"/><category scheme="https://www.ooim.xyz/tags/note/" term="Note" label="Note"/></entry><entry><title type="text">部署自建网站统计服务umami</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/deploy-umami/"/><id>https://www.ooim.xyz/notes/deploy-umami/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2024-01-08T00:00:00+00:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">还是喜欢一波流，docker真香 version: &amp;#39;3&amp;#39; services: umami: image: ghcr.io/umami-software/umami:postgresql-latest ports: - &amp;#34;3000:3000&amp;#34; environment: DATABASE_URL: postgresql://umami:umami@db:5432/umami DATABASE_TYPE: postgresql APP_SECRET: replace-me-with-a-random-string depends_on: db: condition: service_healthy restart: always db: image: postgres:15-alpine environment:……</summary><content type="html">&lt;p>还是喜欢一波流，docker真香&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fb4934">version&lt;/span>: &lt;span style="color:#b8bb26">&amp;#39;3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fb4934">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">umami&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">image&lt;/span>: ghcr.io/umami-software/umami:postgresql-latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#b8bb26">&amp;#34;3000:3000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">DATABASE_URL&lt;/span>: postgresql://umami:umami@db:5432/umami
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">DATABASE_TYPE&lt;/span>: postgresql
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">APP_SECRET&lt;/span>: replace-me-with-a-random-string
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">depends_on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">db&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">condition&lt;/span>: service_healthy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">restart&lt;/span>: always
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">db&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">image&lt;/span>: postgres:15-alpine
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">POSTGRES_DB&lt;/span>: umami
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">POSTGRES_USER&lt;/span>: umami
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">POSTGRES_PASSWORD&lt;/span>: umami
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - umami-db-data:/var/lib/postgresql/data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">restart&lt;/span>: always
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">healthcheck&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">test&lt;/span>: [&lt;span style="color:#b8bb26">&amp;#34;CMD-SHELL&amp;#34;&lt;/span>, &lt;span style="color:#b8bb26">&amp;#34;pg_isready -U $${POSTGRES_USER} -d $${POSTGRES_DB}&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">interval&lt;/span>: 5s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">timeout&lt;/span>: 5s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">retries&lt;/span>: &lt;span style="color:#d3869b">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fb4934">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fb4934">umami-db-data&lt;/span>:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>后续绑定域名，反代端口&lt;code>3000&lt;/code> 就可以舒服享受啦~&lt;/p></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/random/" term="Random" label="Random"/><category scheme="https://www.ooim.xyz/tags/note/" term="Note" label="Note"/></entry><entry><title type="text">绿联NAS部署frp 实现内网穿透</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/deploy-frp-nas/"/><id>https://www.ooim.xyz/notes/deploy-frp-nas/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2023-12-28T22:23:57+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">买入绿联NAS后，再解锁docker技能后，玩法丰富了太多。部署在NAS的各种容器，……</summary><content type="html">&lt;p>&lt;a href="https://www.ooim.xyz/content/nas-settings.md">买入绿联NAS&lt;/a>后，再解锁docker技能后，玩法丰富了太多。部署在NAS的各种容器，为了能方便外网访问，在这个公网ip紧缺的时代，能实现内网穿透尤为重要。
而 &lt;a href="https://github.com/fatedier/frp">frp&lt;/a> 则是一个开源的常见解决方案。&lt;/p>
&lt;blockquote>
&lt;p>frp 是一款高性能的反向代理应用，专注于内网穿透。它支持多种协议，包括 TCP、UDP、HTTP、HTTPS 等，并且具备 P2P 通信功能。使用 frp，您可以安全、便捷地将内网服务暴露到公网，通过拥有公网 IP 的节点进行中转。&lt;/p>
&lt;/blockquote>
&lt;!-- more -->
&lt;h2 id="本质分析">本质分析&lt;/h2>
&lt;p>通过公网服务器部署的frps，利用frpc把客户端的请求反向代理寻址访问到正确的服务地址，从而实现frps-frpc之间的流量转发。&lt;/p>
&lt;h2 id="部署服务端">部署服务端&lt;/h2>
&lt;h3 id="下载frps">下载frps&lt;/h3>
&lt;p>通过官方&lt;a href="https://github.com/fatedier/frp/releases/">release&lt;/a>下载服务器合适版本，如&lt;code>frp_0.53.2_linux_amd64.tar.gz&lt;/code>，然后解压&lt;/p>
&lt;h3 id="创建服务端配置文件">创建服务端配置文件&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano ./frps.toml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>比较简单实用的配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># This configuration file is for reference only. Please do not use this configuration directly to run the program as it may have various issues.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># A literal address or host name for IPv6 must be enclosed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># in square brackets, as in &amp;#34;[::1]:80&amp;#34;, &amp;#34;[ipv6-host]:http&amp;#34; or &amp;#34;[ipv6-host%zone]:80&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># For single &amp;#34;bindAddr&amp;#34; field, no need square brackets, like `bindAddr = &amp;#34;::&amp;#34;`.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bindAddr = &lt;span style="color:#b8bb26">&amp;#34;0.0.0.0&amp;#34;&lt;/span> //服务器ip 默认这个就行
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bindPort = &lt;span style="color:#d3869b">7000&lt;/span> //绑定端口
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Heartbeat configure, it&amp;#39;s not recommended to modify the default value&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># The default value of heartbeatTimeout is 90. Set negative value to disable it.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># transport.heartbeatTimeout = 90&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Pool count in each proxy will keep no more than maxPoolCount.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>transport.maxPoolCount = &lt;span style="color:#d3869b">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># transport.tls.force specifies whether to only accept TLS-encrypted connections. By default, the value is false.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tls.force = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vhostHTTPPort = &lt;span style="color:#d3869b">8080&lt;/span> //多个虚拟主机访问端口
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Response header timeout(seconds) for vhost http server, default is 60s&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># vhostHTTPTimeout = 60&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Configure the web server to enable the dashboard for frps.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># dashboard is available only if webServer.port is set.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webServer.addr = &lt;span style="color:#b8bb26">&amp;#34;127.0.0.1&amp;#34;&lt;/span> //web管理url
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webServer.port = &lt;span style="color:#d3869b">7500&lt;/span> //对应访问端口
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webServer.user = &lt;span style="color:#b8bb26">&amp;#34;admin&amp;#34;&lt;/span> //管理员用户名
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webServer.password = &lt;span style="color:#b8bb26">&amp;#34;admin&amp;#34;&lt;/span> //管理员密码
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Enable golang pprof handlers in dashboard listener.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Dashboard port must be set first&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webServer.pprofEnable = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># enablePrometheus will export prometheus metrics on webServer in /metrics api.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enablePrometheus = &lt;span style="color:#fe8019">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># console or real logFile path like ./frps.log&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log.to = &lt;span style="color:#b8bb26">&amp;#34;./frps.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># trace, debug, info, warn, error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log.level = &lt;span style="color:#b8bb26">&amp;#34;info&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log.maxDays = &lt;span style="color:#d3869b">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># disable log colors when log.to is console, default is false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log.disablePrintColor = &lt;span style="color:#fe8019">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># DetailedErrorsToClient defines whether to send the specific error (with debug info) to frpc. By default, this value is true.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>detailedErrorsToClient = &lt;span style="color:#fe8019">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># auth.method specifies what authentication method to use authenticate frpc with frps.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># If &amp;#34;token&amp;#34; is specified - token will be read into login message.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># If &amp;#34;oidc&amp;#34; is specified - OIDC (Open ID Connect) token will be issued using OIDC settings. By default, this value is &amp;#34;token&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>auth.method = &lt;span style="color:#b8bb26">&amp;#34;token&amp;#34;&lt;/span> //frps-frpc通讯验证方式
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># auth token&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>auth.token = &lt;span style="color:#b8bb26">&amp;#34;12345678&amp;#34;&lt;/span> //一串随机数，但要保证客户端也一样
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># Max ports can be used for each client, default value is 0 means no limit&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>maxPortsPerClient = &lt;span style="color:#d3869b">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># If subDomainHost is not empty, you can set subdomain when type is http or https in frpc&amp;#39;s configure file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic"># When subdomain is est, the host used by routing is test.frps.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>subDomainHost = &lt;span style="color:#b8bb26">&amp;#34;frps.com&amp;#34;&lt;/span> //多个虚拟主机(域名)的主域名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动服务端">启动服务端&lt;/h3>
&lt;p>&lt;code>nohub ./frps -c ./frps.toml &amp;amp;&lt;/code>
可以用&lt;code>netstat -ntpl&lt;/code> 检查上述绑定的各种端口是否已经建立&lt;/p>
&lt;h2 id="部署客户端">部署客户端&lt;/h2>
&lt;h3 id="创建客户端配置文件">创建客户端配置文件&lt;/h3>
&lt;p>提前把&lt;code>frpc.ini&lt;/code>配置好，保存在NAS某个文件夹中，参考配置如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">[common]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">server_addr&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">x.x.x.x //公网vps地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">server_port&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">7000 //之前服务端绑定的端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">token&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">12345678 //与服务端必须一样，不然连不通&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic">#log_file = /dev/null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic">#log_level = info&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#928374;font-style:italic">#log_max_days = 3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">// 每创建一个proxy就建一个[ ]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">[books]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">type&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_ip&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">192.168.3.226&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_port&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">7070&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">remote_port&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">5115 //tcp这个类别可以指定远程服务端端口&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">[bt]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">type&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">http&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_ip&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">192.168.3.226&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_port&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">subdomain&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">mybt&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">[jellyfin]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">type&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">http&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_ip&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">192.168.3.226&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">local_port&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">11301&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b8bb26;font-weight:bold">subdomain&lt;/span> &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">movie&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="新建容器">新建容器&lt;/h3>
&lt;p>在绿联的docker中搜索frpc镜像（如&lt;code>stilleshan/frpc:latest&lt;/code>），拉取到本地后新建容器，记得存储空间要把&lt;code>frpc.ini&lt;/code>路径挂载为&lt;code>/frp/frpc.ini&lt;/code>
最后启动容器。查看日志，看是否连接服务端，通讯是否成功。&lt;/p>
&lt;h2 id="测试">测试&lt;/h2>
&lt;p>访问 &lt;code>vpsip:7500&lt;/code> 查看是否相关proxy都是online的，在线才证明成功连接上。&lt;/p>
&lt;h2 id="enjoy">ENJOY&lt;/h2>
&lt;p>尽情享受，访问 subdomain.frps.com:8080 即可获取NAS部署在内网的各种服务和容器。&lt;/p>
&lt;ul>
&lt;li>vpsip:5115 即是 192.168.3.226:7070 这个服务&lt;/li>
&lt;li>mybt.frps.com:8080 即是 192.168.3.226:8080 这个服务&lt;/li>
&lt;li>movie.frps.com:8080 即是 192.168.3.226:11301这个服务&lt;/li>
&lt;/ul></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/nas/" term="Nas" label="Nas"/><category scheme="https://www.ooim.xyz/tags/docker/" term="Docker" label="Docker"/><category scheme="https://www.ooim.xyz/tags/frp/" term="Frp" label="Frp"/></entry><entry><title type="text">通过设置代理解决github不能正常连通</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/github-proxy/"/><id>https://www.ooim.xyz/notes/github-proxy/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2023-12-20T19:53:38+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">突然发现无法使用 git@github.com:user/repo 推送或拉取代码了，之前明明可以。证明抽风了。解决方法只能上代理，晕……</summary><content type="html">&lt;p>突然发现无法使用 &lt;code>git@github.com:user/repo&lt;/code> 推送或拉取代码了，之前明明可以。证明抽风了。解决方法只能上代理，晕啊。&lt;/p>
&lt;h2 id="方法一-创建-sshconfig">方法一 创建 &lt;code>~/.ssh/config&lt;/code>&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Host github.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> User git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ProxyCommand connect -H 127.0.0.1:10809 %h %p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这是要求走http代理的设置，把端口改为你的代理端口&lt;/p>
&lt;p>另一种是换成这个，强制走443端口利用https协议&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Host github.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Hostname ssh.github.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Port &lt;span style="color:#d3869b">443&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="方法二-设置全局代理">方法二 设置全局代理&lt;/h2>
&lt;p>&lt;code>git config –global http.proxy protocol://127.0.0.1:port&lt;/code>&lt;/p>
&lt;p>如&lt;/p>
&lt;p>&lt;code>git config --global http.proxy socks5h://127.0.0.1:1080&lt;/code>&lt;/p>
&lt;p>但这个方法对我无效&lt;/p>
&lt;h2 id="参考ref">参考ref&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/bluethon/45766d0a4541ab633e32a49b6c4e4bdd">gist&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-a-proxy-server-with-self-hosted-runners">github doc&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://v2ex.com/t/849046">v2ex&lt;/a>&lt;/li>
&lt;/ul></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/github/" term="Github" label="Github"/><category scheme="https://www.ooim.xyz/tags/proxy/" term="Proxy" label="Proxy"/></entry><entry><title type="text">利用cf搭建imgur反代 支持评论图片自动上传</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/cf-proxy/"/><id>https://www.ooim.xyz/notes/cf-proxy/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2023-11-28T16:23:13+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">Typecho博客系统中的Sakura主题默认支持图片自动上传，但imgur默认访问……</summary><content type="html">
&lt;blockquote>
&lt;p>Typecho博客系统中的Sakura主题默认支持图片自动上传，但imgur默认访问有问题，故此设置一下完美支持imgur&lt;/p>
&lt;/blockquote>
&lt;div id="outline-container-headline-1" class="outline-2">
&lt;h2 id="headline-1">
原理分析
&lt;/h2>
&lt;div id="outline-text-headline-1" class="outline-text-2">
&lt;ul>
&lt;li>利用Cloudflare的worker搭建imgur反代&lt;/li>
&lt;li>修改主题下相关文件&lt;/li>
&lt;li>后台进行主题设置 添加反代地址&lt;/li>
&lt;/ul>
&lt;div id="outline-container-headline-2" class="outline-3">
&lt;h3 id="headline-2">
搭建反代
&lt;/h3>
&lt;div id="outline-text-headline-2" class="outline-text-3">
&lt;ol>
&lt;li>进入 Cloudflare 的 worker 界面，创建一个新的，删掉默认代码，用以下代码部署&lt;/li>
&lt;/ol>
&lt;div class="src src-js">
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>addEventListener(&lt;span style="color:#b8bb26">&amp;#34;fetch&amp;#34;&lt;/span>, event =&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fe8019">let&lt;/span> url &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">new&lt;/span> URL(event.request.url);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> url.protocol &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#39;https:&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fe8019">&amp;lt;&lt;/span>mark&lt;span style="color:#fe8019">&amp;gt;&lt;/span>url.hostname &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#34;i.imgur.com&amp;#34;&lt;/span>;&lt;span style="color:#fe8019">&amp;lt;&lt;/span>/mark&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fe8019">let&lt;/span> request &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">new&lt;/span> Request(url, event.request);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> event.respondWith(fetch(request));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;p>
将得到 &lt;code class="verbatim">https://foo.boo.workers.dev&lt;/code> 的访问域名，到此将实现原本需要 &lt;code class="verbatim">https://i.imgur.com/Ch0lmFc.jpg&lt;/code> 访问的变为只需要 &lt;code class="verbatim">https://foo.boo.workers.dev/Ch0lmFc.jpg&lt;/code> 即可。&lt;/p>
&lt;ol>
&lt;li>某些网络环境，workers.dev 域名支持不好，故此要绑定自定义个性化域名 &lt;/li>
&lt;/ol>
&lt;p>在 worker 界面中的 Custom Domains，添加自定义域。你的 CF 账号下的任何一个域名都可以设置个二级子域名或三级，到此实现了 利用 &lt;code class="verbatim">https://yourdomain.name/Ch0lmFc.jpg&lt;/code>&lt;/p>
&lt;/div>
&lt;/div>
&lt;div id="outline-container-headline-3" class="outline-3">
&lt;h3 id="headline-3">
修改主题相关文件
&lt;/h3>
&lt;div id="outline-text-headline-3" class="outline-text-3">
&lt;p>
文件路径 &lt;code class="verbatim">wp-contents/themes/sakura/inc/classes/Images.php&lt;/code> 也可以在 wp 后台直接定位找到
对于 imgur 上传代码段进行小改动即可，上传逻辑和方法不变，只需要在最后生成的链接替换成我们搭建的反代域名链接
在这个上传接口代码块里面，找到上传成功后处理的代码，进行修改。&lt;/p>
&lt;div class="src src-php">
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">public&lt;/span> &lt;span style="color:#fe8019">function&lt;/span> &lt;span style="color:#fabd2f">Imgur_API&lt;/span>($image) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $upload_url &lt;span style="color:#fe8019">=&lt;/span> akina_option(&lt;span style="color:#b8bb26">&amp;#39;imgur_upload_image_proxy&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $args &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">array&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;headers&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> &lt;span style="color:#fe8019">array&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;Authorization&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> &lt;span style="color:#b8bb26">&amp;#39;Client-ID &amp;#39;&lt;/span> &lt;span style="color:#fe8019">.&lt;/span> $this&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">imgur_client_id&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;body&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> &lt;span style="color:#fe8019">array&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;image&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> base64_encode($image),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $response &lt;span style="color:#fe8019">=&lt;/span> wp_remote_post($upload_url, $args);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $reply &lt;span style="color:#fe8019">=&lt;/span> json_decode($response[&lt;span style="color:#b8bb26">&amp;#34;body&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fe8019">if&lt;/span> ($reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">success&lt;/span> &lt;span style="color:#fe8019">&amp;amp;&amp;amp;&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">status&lt;/span> &lt;span style="color:#fe8019">==&lt;/span> &lt;span style="color:#d3869b">200&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $status &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#d3869b">200&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $success &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $message &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#34;success&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $link &lt;span style="color:#fe8019">=&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">data&lt;/span>&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">link&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $newlink &lt;span style="color:#fe8019">=&lt;/span> parse_url($link,PHP_URL_PATH);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $proxy &lt;span style="color:#fe8019">=&lt;/span> akina_option(&lt;span style="color:#b8bb26">&amp;#39;cmt_image_proxy&amp;#39;&lt;/span>) &lt;span style="color:#fe8019">.&lt;/span> $newlink;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#fe8019">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $status &lt;span style="color:#fe8019">=&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">status&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $success &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $message &lt;span style="color:#fe8019">=&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">data&lt;/span>&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">error&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $link &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#39;https://view.moezx.cc/images/2019/10/28/default_d_h_large.gif&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $proxy &lt;span style="color:#fe8019">=&lt;/span> akina_option(&lt;span style="color:#b8bb26">&amp;#39;cmt_image_proxy&amp;#39;&lt;/span>) &lt;span style="color:#fe8019">.&lt;/span> $link;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $output &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">array&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;status&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> $status,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;success&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> $success,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;message&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> $message,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;link&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> $link,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#b8bb26">&amp;#39;proxy&amp;#39;&lt;/span> &lt;span style="color:#fe8019">=&amp;gt;&lt;/span> $proxy,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#fe8019">return&lt;/span> $output;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;p>
利用 php 内置函数 &lt;code class="verbatim">parse_url&lt;/code> 进行处理
简单复习一下，&lt;a href="https://www.php.net/manual/zh/function.parse-url.php">官方函数说明&lt;/a>&lt;/p>
&lt;p>
&lt;code class="verbatim">parse_url(string $url, int $component = -1): int|string|array|null|false&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>
本函数解析 URL 并返回关联数组，包含在 URL 中出现的各种组成部分。数组的元素值不会 URL 解码。本函数不是用来验证给定 URL 的有效性的，只是将其分解为下面列出的部分。也会接受不完整或无效的 URL，parse\_url() 会尝试尽量正确解析。&lt;/p>
&lt;/blockquote>
&lt;p>
如以下代码&lt;/p>
&lt;div class="src src-php">
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>$url &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#39;http://username:password@hostname:9090/path?arg=value#anchor&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_SCHEME));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_USER));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_PASS));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_HOST));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_PORT));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_PATH));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_QUERY));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>var_dump(parse_url($url, PHP_URL_FRAGMENT));&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;p>
将输出&lt;/p>
&lt;div class="src src-text">
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>array(8) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;scheme&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(4) &amp;#34;http&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;host&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(8) &amp;#34;hostname&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;port&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int(9090)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;user&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(8) &amp;#34;username&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;pass&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(8) &amp;#34;password&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;path&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(5) &amp;#34;/path&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;query&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(9) &amp;#34;arg=value&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&amp;#34;fragment&amp;#34;]=&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string(6) &amp;#34;anchor&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(4) &amp;#34;http&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(8) &amp;#34;username&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(8) &amp;#34;password&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(8) &amp;#34;hostname&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>int(9090)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(5) &amp;#34;/path&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(9) &amp;#34;arg=value&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string(6) &amp;#34;anchor&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;p>
复习完拉。
这里只需要把上传成功的 url 中的 &lt;code class="verbatim">/path&lt;/code> 提取出来，再与自定义反代域名拼接即可
处理过程：
&lt;code class="verbatim">$newlink = parse_url($link,PHP_URL_PATH); =
=$proxy = akina_option(&amp;#39;cmt_image_proxy&amp;#39;) . $newlink;&lt;/code>
最后结果：&lt;/p>
&lt;div class="src src-php">
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#fe8019">if&lt;/span> ($reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">success&lt;/span> &lt;span style="color:#fe8019">&amp;amp;&amp;amp;&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">status&lt;/span> &lt;span style="color:#fe8019">==&lt;/span> &lt;span style="color:#d3869b">200&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $status &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#d3869b">200&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $success &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#fe8019">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $message &lt;span style="color:#fe8019">=&lt;/span> &lt;span style="color:#b8bb26">&amp;#34;success&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $link &lt;span style="color:#fe8019">=&lt;/span> $reply&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">data&lt;/span>&lt;span style="color:#fe8019">-&amp;gt;&lt;/span>&lt;span style="color:#b8bb26;font-weight:bold">link&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $newlink &lt;span style="color:#fe8019">=&lt;/span> parse_url($link,PHP_URL_PATH);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $proxy &lt;span style="color:#fe8019">=&lt;/span> akina_option(&lt;span style="color:#b8bb26">&amp;#39;cmt_image_proxy&amp;#39;&lt;/span>) &lt;span style="color:#fe8019">.&lt;/span> $newlink;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;p>
如图： &lt;/p>
&lt;p>
&lt;img src="https://cdn.ooim.xyz/41fce1700d269e43fdd61707d9041bf2.png" alt="https://cdn.ooim.xyz/41fce1700d269e43fdd61707d9041bf2.png" title="https://cdn.ooim.xyz/41fce1700d269e43fdd61707d9041bf2.png" />&lt;/p>
&lt;/div>
&lt;/div>
&lt;div id="outline-container-headline-4" class="outline-3">
&lt;h3 id="headline-4">
填入主题设置中的反代地址
&lt;/h3>
&lt;div id="outline-text-headline-4" class="outline-text-3">
&lt;p>
把自定义反代域名完整 url 填入，刷新即可 &lt;/p>
&lt;p>
&lt;img src="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" alt="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" title="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" />&lt;img src="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" alt="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" title="https://cdn.ooim.xyz/9fe7abaf9120fc569ea02ecb7d8d7155.png" />&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div id="outline-container-headline-5" class="outline-2">
&lt;h2 id="headline-5">
参考链接：
&lt;/h2>
&lt;div id="outline-text-headline-5" class="outline-text-2">
&lt;ul>
&lt;li>&lt;a href="https://github.com/mashirozx/sakura/blob/b73c45f0221ae196f9feffb626ad927e524a5dba/inc/classes/Images.php">Sakura主题开源具体文件&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/XIU2/CloudflareSpeedTest/issues/168#issuecomment-1028697209">Cloudflare worker反代&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/div></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/></entry><entry><title type="text">一加 Ace 2 Pro 折腾记录</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/oneplus-modify/"/><id>https://www.ooim.xyz/notes/oneplus-modify/</id><updated>2024-02-04T11:34:49+08:00</updated><published>2023-11-15T19:14:49+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">从一加 8 Pro 换到一加 Ace 2 Pro ，Android 还是折腾一下才好玩 系统 一定在出厂版本要备份 全……</summary><content type="html">&lt;blockquote>
&lt;p>从一加 8 Pro 换到一加 Ace 2 Pro ，Android 还是折腾一下才好玩&lt;/p>
&lt;/blockquote>
&lt;h2 id="系统">系统&lt;/h2>
&lt;p>一定在出厂版本要备份 &lt;em>全部分区&lt;/em> ，也就是俗称的字库~~~~
还有不要用&lt;code>Fastboot Enhance&lt;/code> 这个图形化软件，不清楚分区情况。一刷就寄了。血的教训啊，不然天天跑售后！&lt;/p>
&lt;p>2024.02.06 去常平售后刷回C13.411版本&lt;/p>
&lt;p>[x] 遗憾现在很少类原生rom&lt;/p>
&lt;h3 id="回到出厂包">回到出厂包&lt;/h3>
&lt;p>用这个 &lt;code>PJA110domestic_11_13.1.1.302CN01_2023072223340105.zip&lt;/code> 用流出来的那个9008软件(windows平台)，回归到最原始包（真正的出厂状态）&lt;/p>
&lt;h3 id="升级然后解锁bl">升级，然后解锁BL&lt;/h3>
&lt;p>OTA升级到 &lt;code>color 13.1 552&lt;/code> ，重启到 fastboot 模式，&lt;code>flash oem unlock&lt;/code> 解锁BL&lt;/p>
&lt;h3 id="root再安装模块">root，再安装模块&lt;/h3>
&lt;p>一键root，再安装&lt;code>magisk hide&lt;/code>，绕过银行类app&lt;/p>
&lt;h2 id="照片">照片&lt;/h2>
&lt;p>经常备份到 NAS（Network Attached Storage 网络附加存储），妈妈再也不用担心刷机&lt;/p>
&lt;h2 id="git">git&lt;/h2>
&lt;ul>
&lt;li>配置好，手机发博客&lt;/li>
&lt;li>学习Liunx系统&lt;/li>
&lt;/ul></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/phone/" term="Phone" label="Phone"/><category scheme="https://www.ooim.xyz/tags/oneplus/" term="Oneplus" label="Oneplus"/></entry><entry><title type="text">买入绿联NAS</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/nas-setting/"/><id>https://www.ooim.xyz/notes/nas-setting/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2023-11-15T19:14:07+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">2023年双十一入手绿联DX4600+，果然人到中年真的开始折腾NAS了 希望用好这个……</summary><content type="html">&lt;p>2023年双十一入手绿联DX4600+，果然人到中年真的开始折腾NAS了
希望用好这个机器，杜绝存储焦虑，过上舒服生活，&lt;del>其实是打工人&lt;/del> 敢于做自己。&lt;/p>
&lt;h2 id="照片">照片&lt;/h2>
&lt;h2 id="内网穿透">内网穿透&lt;/h2>
&lt;p>部署frp可以实现 &lt;a href="../deploy-frp-nas/">绿联NAS部署frp 实现内网穿透&lt;/a>&lt;/p>
&lt;h2 id="私人影院">私人影院&lt;/h2></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/journal/" term="Journal" label="Journal"/><category scheme="https://www.ooim.xyz/tags/nas/" term="Nas" label="Nas"/></entry><entry><title type="text">阿波罗</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/aphorism/apollo/"/><id>https://www.ooim.xyz/aphorism/apollo/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2020-04-30T08:58:45+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">这天我在惺忪睡梦中醒来，我看到一个月桂为冠的俊美青年，他静静地漫步而过，仿佛这是一个……</summary><content type="html">&lt;p>这天我在惺忪睡梦中醒来，我看到一个月桂为冠的俊美青年，他静静地漫步而过，仿佛这是一个独自而在的无人之梦。&lt;/p>
&lt;p>哦，我轻叹这个充溢着桂月圣白的世界。我不知这是否也是一个梦境，但我无力破坏此缕恒静，我只愿此是恒梦。&lt;/p>
&lt;p>忘却了生活的烦恼，就连那循环的轮回也消失了，甚至孤独也消散了。此时此刻，我只闻内心定稳的平静和满足。&lt;/p>
&lt;p>重压之魔渐离了，方向消逝了，我只觉身体浮动在时空。此时此刻，自己幻为一片超然落叶，飘逸在这无声永恒。&lt;/p>
&lt;p>一个天使将我从漩涡中浮起，一个真理在我眼前蒙蒙浮现。此时此刻，一个自己看到三人静立在纯净的淡蓝天空。&lt;/p>
&lt;p>疲惫的粒子停止了爱恨，机械的齿轮失去了魔力。宁静蚀来，一丝莱雅的悠扬，整个世界都浸入了这淡淡的迷醉。&lt;/p>
&lt;p>芳香远去，内心燃起一个火苗——我想高声地呼喊，我想紧紧地拥抱，我想深深地热吻——随即被一缕微风治愈。&lt;/p></content><category scheme="https://www.ooim.xyz/aphorism/" term="aphorism" label="aphorism"/><category scheme="https://www.ooim.xyz/tags/%E6%97%A5%E7%A5%9E/" term="日神" label="日神"/></entry><entry><title type="text">《动物农场》</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/notes/animal-farm/"/><id>https://www.ooim.xyz/notes/animal-farm/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2020-03-16T19:31:33+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">1 这是一篇乔治·奥威尔名作，可能我们对他的《1984》更为耳熟，但相比而言我更喜欢这……</summary><content type="html">&lt;p>&lt;sup id="fnref:1">&lt;a href="https://www.ooim.xyz/notes/animal-farm/#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;img src="https://www.ooim.xyz/images/animal-farm.jpg" alt="animal-farm.jpg">&lt;/p>
&lt;p>这是一篇乔治·奥威尔名作，可能我们对他的《1984》更为耳熟，但相比而言我更喜欢这部《动物农场》。为什么呢？可能我现在年轻，经历少，思维比较简单，所以这篇没有性描述的童话故事更合我现在的胃口。&lt;/p>
&lt;p>这个故事不长，如果你尚未阅读，我建议你找个时间一口气读完。这个故事讲的是什么呢？大概就是一群农场内被人剥削的动物革命推翻农场主后却被之中的伟大领袖猪——这个独裁者——继续剥削的故事。这样一个故事，作者的写作动机是批判当时的苏联以及其伟大领袖斯大林，但这个故事的价值却不会随着苏联的解体而消失。&lt;/p>
&lt;p>社会的阶级是一直存在的，无论是远古还是现代，无论是资本还是共产，这是人类社会的本性。形而上地来说，存在的本质是逆熵。文明，也是如此，故其本性就是不平均——因为平均等于混乱等于非文明等于不存在。政治伦理地来说，若将平等定义为正义，那么平均意义上的平等维护了社会的正义，却同时也违背了个人的正义——个人视角上的平均等于不平等也即不正义。从发展来说，平均意义上的平等会扼杀个人动力，进而导致社会成为一潭死水。因此，尽管不平等程度是评价一个社会好坏的标准，但其绝对不是唯一的标准。这也就是说，无论一个社会的制度╱主义是什么，其根本上都无法解决不平等的问题，其根本上都无法解决极权的问题，其根本上都无法解决独裁者的问题——这是人类社会，也即文明的本性。&lt;sup id="fnref:2">&lt;a href="https://www.ooim.xyz/notes/animal-farm/#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/p>
&lt;p>哲学之所以为哲学，就在于哲学要在循环之外探求一个最终解。所以，我想问题的关键不是如何去推翻，而是如何去更好地管理。如何减少极权和独裁者对社会的危害呢？将权力交给一个绝对正义的第三者——人工智能？我想这更不可能让人接受。构建一个去中心化的社会制度？可惜的是，人类是一个中心化的组织，这无法改变。一个去中心化的组织就如共产主义，其无法避免极权的问题，甚至因为其「理性统一性」而更容易导致极权。我们也可以将共产主义和无法避免的中心化这两个条件作为基础，设想一下实现了这样的社会是个怎样的社会——博格立方体——由控制到终极控制——同化。这样的社会是正义的吗？我想，该社会的「理性统一性」肯定会将这个问题定义为一个完整的句号，而非开放的问号。能够用问号去质疑，这点其实是非常重要的，因为在极权和独裁者眼中，这是绝对禁止的——因为言论自由是极权和独裁者的要害。&lt;/p>
&lt;p>如果说国家是一个大写的人，那么共产主义就如人的偏激状态，而人在短暂的偏激之后总是会后悔。当然，我并不是说每个人都应该去反对共产主义，因为这种「理性统一性」本身也是一种偏激。人类社会应该要有多样性，人类社会不能臣服于「绝对理性」。我们知道，科学是现代社会的「第一推动」，而科学的兴起是与宗教的衰弱相伴随的，但我们能否说科学已经杀死了宗教呢？我想，答案肯定是否定的，科学只杀死了宗教的不科学部分。宗教其它部分依然存在且影响巨大，即使在现代社会，科学依然要屡屡让步于宗教伦理，因为科学无法解决科学之外的问题，因为将自己化为唯一的权威不是科学的精神，因为并非每个人都信仰科学。社会制度的选择也类似，我们应该秉承一种科学的精神，让每个人都要有选择的权利。&lt;/p>
&lt;p>我想，科学之中是有唯一的标准的，其正确性可以通过数学的推导来证明，但是社会之中是否也有这样可证明判定的唯一标准呢？不用问我，我也不知道。但我想，如果其存在并践行，那么这样的「理性统一性」的社会是一个好的社会吗？毕竟，无法判定的论点，永远存在的分歧，在一定程度上的确是一个需解决的效率问题。但无论如何，这个问题，未来终究会有个结果的，因为时间总是单向地将我们推向未来。&lt;/p>
&lt;hr>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>图源：&lt;a href="https://twitter.com/coldplayxtra/status/1237845975521091586">https://twitter.com/coldplayxtra/status/1237845975521091586&lt;/a>&amp;#160;&lt;a href="https://www.ooim.xyz/notes/animal-farm/#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>纠正：&lt;a href="https://t.me/yixiuer/993">https://t.me/yixiuer/993&lt;/a>&amp;#160;&lt;a href="https://www.ooim.xyz/notes/animal-farm/#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></content><category scheme="https://www.ooim.xyz/notes/" term="notes" label="notes"/><category scheme="https://www.ooim.xyz/tags/%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/" term="反乌托邦" label="反乌托邦"/></entry><entry><title type="text">集权管理与去中心化</title><link rel="alternate" type="text/html" href="https://www.ooim.xyz/idea/centralization-and-decentralization/"/><id>https://www.ooim.xyz/idea/centralization-and-decentralization/</id><updated>2024-02-28T16:08:54+00:00</updated><published>2019-01-24T00:15:59+08:00</published><author><name>Wah Lau</name><uri>https://www.ooim.xyz/</uri></author><rights>在保留本文作者及本文鏈接的前提下，非商業用途隨意轉載分享。</rights><summary type="html">古代中国封建王朝带给近代中国的落后，西方黑暗中世纪带给世人的阴影，更不用说那些美洲土……</summary><content type="html">&lt;p>古代中国封建王朝带给近代中国的落后，西方黑暗中世纪带给世人的阴影，更不用说那些美洲土地上已被灭绝的部落，这一个个悲剧的背后，都有着一个黑影——中心化。&lt;/p>
&lt;p>中心化的集权管理一直是人类的管理方式，小到家庭，大到国家。尽管官僚与享乐一直是其致命的弊端，它们使得管理变得低效甚至毁灭，但它却一直是人类的管理方式。究其根本，是因为没有了中心化的管理，人类社会只会变成一盘散沙、一潭烂泥，互联网世界中的例子就是暗网、零网等。虽然它们防审查，保护了我们的隐私，但它们上面的内容却大部分是情色、暴力、犯罪等。你真的能忍受一个去中心化、完全自由的世界吗？人类必须要有一个中心化的集权组织管理，人类就是一个被控制欲控制的希腊悲剧。那么，如何从根本上解决这个问题？而不是靠一次又一次的悲剧来清洗弊端的积累？&lt;/p>
&lt;p>在与现实世界截然不同的互联网世界，似乎有削弱中心化的能力，其动力是来自遥远的文艺复兴的自由平等。互联网的世界，一直有一种去中心化的文化。一方面，互联网的世界应该是一个比现实世界更理想、更美好、更自由、更平等的世界，不应该有中心化的管理；一方面，中心化的互联网易受现实社会中的政府监管，而去中心化则让我们拥有隐私，让我们拥有自由平等；另外，互联网诞生之初就存在一种去中心化的架构（P2P&lt;sup id="fnref:1">&lt;a href="https://www.ooim.xyz/idea/centralization-and-decentralization/#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>），这构成了一种技术基础。正是如此，在互联网世界，似乎总存在着对中心化的现实世界的某种反抗，暗网、零网等对审查的反抗，著名的种子分享下载站海盗湾对版权的反抗，比特币对由国家控制的传统货币的反抗……&lt;/p>
&lt;p>在互联网时代，会诞生一种新的去中心化的管理架构吗？至少，比特币的巨大影响及其带来的区块链技术让我们看到了可能性。不过，我们先来看看连比特币都要受其影响的一种模式——开源模式。就其特点来说，开源模式一定程度上集成了去中心化，它汇聚人人的力量，齐心创造了一个个奇迹，它最终必将证明：在软件行业，胜利属于开源，而非闭源的大教堂！开源的胜利，似乎也是自由平等的胜利，是文艺复兴的最终胜利，大教堂必将被自由平等推倒！那么，可以借鉴开源来创造一种新的去中心化的管理架构吗？且慢，虽然开源有一些去中心化的特点，但它依旧是一个中心化的架构，它仍需要管理者、领袖，它的内部依然存在众多分歧，甚至成为仇恨。回到比特币，它虽然让整个人类社会为之一震，但只停留在了对正统权威的一种挑战，而非颠覆。去中心化，任重而道远。&lt;/p>
&lt;p>未来，如何创造一种这样的管理架构，这种架构能将去中心化的优点融入中心化，甚至能通过某种耦合来抵消中心化与去中心化各自的弊端？&lt;sup id="fnref:2">&lt;a href="https://www.ooim.xyz/idea/centralization-and-decentralization/#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>&lt;/p>
&lt;hr>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>更多：&lt;a href="https://en.wikipedia.org/wiki/Peer-to-peer">https://en.wikipedia.org/wiki/Peer-to-peer&lt;/a>&amp;#160;&lt;a href="https://www.ooim.xyz/idea/centralization-and-decentralization/#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>纠正：&lt;a href="https://t.me/yixiuer/934">https://t.me/yixiuer/934&lt;/a>&amp;#160;&lt;a href="https://www.ooim.xyz/idea/centralization-and-decentralization/#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></content><category scheme="https://www.ooim.xyz/idea/" term="idea" label="idea"/><category scheme="https://www.ooim.xyz/tags/%E4%B8%AD%E5%BF%83%E5%8C%96/" term="中心化" label="中心化"/></entry></feed>